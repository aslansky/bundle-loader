/*! BundleLoader - v0.2.0 - 2013-05-07 */
(function(e,t){"object"==typeof exports?module.exports=t(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],function(r){return e.Loader=t(r),e.Loader}):e.Loader=t(e.jQuery)})(this,function(e){"use strict";function t(){r(),m.autoload&&x.load()}function r(){e("["+m.attr+"]").each(function(){var t=e(this).data()[m.attr.replace("data-","")];t=t.split(","),e.each(t,function(){-1===e.inArray(this+"",h)&&h.push(e.trim(this))})})}function a(t){e.ajax({url:m.path+t+".js",dataType:"script",cache:m.cache}).done(function(e){o(t,e)}).fail(function(e,r,a){i(t,r,a)}).always(function(){0>=j&&c()})}function n(t,r){var a=e('<script type="text/javascript" defer>'+r.data+"</script>");a.text(),e("head").append(a),o(t),0>=j&&c()}function o(e,t){j--,y&&t&&u(e,t),g.push(""+e),f.notify("loaded",e,!t)}function i(e,t,r){j--,p.push(""+e),console&&"function"==typeof console.log&&r.name&&(r.stack?console.log(r.stack):console.log(r.name+": "+r.message)),f.notify("error",e,t,r)}function c(){p.length>0?f.reject(g,p):f.resolve(g,p)}function u(e,t){var r=+new Date,a={};a.data=t,a.time=r,a.buster=m.cacheBuster,a.expire=r+1e3*60*60*m.expiration,localStorage.setItem(m.storagePrefix+e,JSON.stringify(a))}function l(e){var t=localStorage.getItem(m.storagePrefix+e);try{return t=JSON.parse(t||"false"),t.data&&t.expire-+new Date>0&&t.buster===m.cacheBuster?t:(localStorage.removeItem(m.storagePrefix+e),!1)}catch(r){return!1}}function s(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}var f=null,d=0,h=[],p=[],g=[],y=s(),j=0,m={path:"/",attr:"data-require",autoload:!0,cache:!0,store:!0,storagePrefix:"loader-",expiration:2,cacheBuster:""},x=function(r){return f=e.Deferred(),d=0,h=[],p=[],g=[],jQuery.extend(m,r),y=y&&m.store,t(),f.promise(x)};return x.load=function(t){var o=!1;return j=h.length,t&&(g=[],p=[],r()),e.each(h,function(){if(-1===e.inArray(t,g)){var t=this;y&&(o=l(t)),o?n(t,o):a(t)}}),f.promise(x)},x.callback=function(t,r,a){var n=this;return function(o){var i=this;jQuery.isFunction(a)&&a.call(i),o.preventDefault(),h.push(t),n.done(function(t,a){o.handleObj&&o.handleObj.handler&&e(i).off(o.type,o.handleObj.handler).trigger(o),jQuery.isFunction(r)&&r.call(i,o,t,a)}).load()}},x.clearStorage=function(){return localStorage.clear(),f.promise(x)},x.loaded=g,x.failed=p,x});