/*! BundleLoader - v0.2.0 - 2013-07-15 */
(function(e,t){"object"==typeof exports?module.exports=t(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],function(r){return e.Loader=t(r),e.Loader}):e.Loader=t(e.jQuery)})(this,function(e){"use strict";function t(){r(),v.autoload&&m.load()}function r(){e("["+v.attr+"]").each(function(){var t=e(this).data()[v.attr.replace("data-","")];t=t.split(","),e.each(t,function(){-1===e.inArray(this+"",p)&&p.push(e.trim(this))})})}function n(t){e.ajax({url:v.path+t+".js",dataType:"script",cache:v.cache}).done(function(e){o(t,e)}).fail(function(e,r,n){i(t,r,n)}).always(function(){0>=x&&c()})}function a(t,r){var n=e('<script type="text/javascript" defer>'+r.data+"</script>");n.text(),e("head").append(n),o(t),0>=x&&c()}function o(e,t){x--,j&&t&&u(e,t),g.push(""+e),d.notify("loaded",e,!t)}function i(e,t,r){x--,y.push(""+e),console&&"function"==typeof console.log&&console.log(""+r),d.notify("error",e,t,r)}function c(){y.length>0?d.reject(g,y):d.resolve(g,y)}function u(e,t){var r=+new Date,n={};n.data=t,n.time=r,n.buster=v.cacheBuster,n.expire=r+1e3*60*60*v.expiration,localStorage.setItem(v.storagePrefix+e,JSON.stringify(n))}function l(e){return e.data&&e.expire-+new Date>0&&e.buster===v.cacheBuster}function f(e){try{var t=JSON.parse(localStorage.getItem(v.storagePrefix+e));return l(t)?t:(localStorage.removeItem(v.storagePrefix+e),!1)}catch(r){return!1}}function s(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}var d=null,h=0,p=[],y=[],g=[],j=s(),x=0,v={path:"/",attr:"data-require",autoload:!0,cache:!0,store:!0,storagePrefix:"loader-",expiration:2,cacheBuster:""},m=function(r){return d=e.Deferred(),h=0,p=[],y=[],g=[],jQuery.extend(v,r),j=j&&v.store,t(),d.promise(m)};return m.load=function(t){var o=!1;return x=p.length,t&&(g=[],y=[],r()),e.each(p,function(){if(-1===e.inArray(t,g)){var t=this;j&&(o=f(t)),o?a(t,o):n(t)}}),d.promise(m)},m.callback=function(t,r,n){var a=this;return function(o){var i=this;jQuery.isFunction(n)&&n.call(i),o.preventDefault(),p.push(t),a.done(function(t,n){o.handleObj&&o.handleObj.handler&&e(i).off(o.type,o.handleObj.handler).trigger(o),jQuery.isFunction(r)&&r.call(i,o,t,n)}).load()}},m.clearStorage=function(){return localStorage.clear(),d.promise(m)},m.loaded=g,m.failed=y,m});